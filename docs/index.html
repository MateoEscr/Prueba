<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Los mejores 6 meses de mi vida</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        /* ---------- Variables y reset ---------- */
        :root{
            --bg: #F1F8E9; 
            --accent: #66BB6A; 
            --accent-dark: #388E3C;
            --text: #1B5E20; 
            --glass: rgba(255, 255, 255, 0.7);
            --glass-strong: rgba(255, 255, 255, 0.9);
            --card-shadow: 0 8px 32px rgba(102, 187, 106, 0.15);
            --rounded: 20px;
            --pink-shadow: rgba(129, 199, 132, 0.4); 
            --green-shadow: rgba(76, 175, 80, 0.3);
        }
        *{box-sizing:border-box}
        html,body{height:100%; overflow-x:hidden;}
        body{ 
            margin:0; 
            font-family: 'Quicksand', Inter, "Segoe UI", Roboto, Arial, sans-serif; 
            background: var(--bg); 
            color:var(--text); 
            -webkit-font-smoothing:antialiased; 
            -moz-osx-font-smoothing:grayscale; 
            -webkit-touch-callout:none; 
        }
        
        /* ---------- BARRA DE PROGRESO ---------- */
        #progressBar { position: fixed; top: 0; left: 0; height: 4px; background: linear-gradient(90deg, #ff6b6b, var(--accent)); width: 0%; z-index: 10000; transition: width 0.1s linear; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        
        #emoji-bg{ position:fixed; inset:0; z-index:-3; pointer-events:none; overflow:hidden; }
        .emoji{ position:absolute; opacity:0.07; font-size: calc(14px + 1.4vw); animation: float linear infinite; animation-duration: calc(10s + var(--random-duration)); animation-delay: calc(var(--random-delay) * -1s); }
        @keyframes float{ from{ transform: translateY(110vh) rotate(0deg); } to{ transform: translateY(-10vh) rotate(360deg); } }

        #loader{ position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background: var(--bg); z-index:9999; transition: opacity .5s ease, visibility .5s; }
        #loader.hidden{ opacity:0; visibility:hidden; }

        /* ---------- Confirm Card ---------- */
        #confirm{ position:fixed; inset:0; display:grid; place-items:center; z-index:9998; padding: 20px; background: var(--bg); }
        .confirm-card{ width:100%; max-width:520px; border-radius:18px; padding:18px; background:var(--glass-strong); box-shadow:var(--card-shadow); backdrop-filter:blur(6px); display:flex; flex-direction:column; gap:12px; align-items:center; text-align: center; }
        #openBtn { padding: 10px 30px; font-size: 1.2rem; font-weight: 700; border-radius: 8px; border: none; background: var(--accent); color: white; cursor: pointer; transition: 0.2s; }
        #openBtn:hover { background: #388e3c; }

        /* ---------- Players ---------- */
        .player-wrapper { display: flex; justify-content: center; position: sticky; top: 10px; z-index: 1000; margin-bottom: 20px; pointer-events: none; width: 100%; }
        .compact-player { display: flex; align-items: center; gap: 12px; width: auto; max-width: fit-content; padding: 8px 15px; border-radius: var(--rounded); background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px); box-shadow: var(--card-shadow); border: 1px solid rgba(102, 187, 106, 0.2); pointer-events: auto; }
        .cover-wrap { width: 50px; height: 50px; flex: 0 0 50px; border-radius: 8px; overflow: hidden; position: relative; }
        .cover-wrap img{ width:100%; height:100%; object-fit:cover; display:block; }
        .play-circle{ width:36px; height:36px; border-radius:50%; display:grid; place-items:center; background:rgba(255,255,255,0.2); border:2px solid rgba(255,255,255,0.3); cursor:pointer; position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); }
        .player-meta { display:flex; flex-direction:column; gap:2px; }
        .small-progress input[type="range"]{ width:120px; -webkit-appearance:none; height:4px; background: #ddd; border-radius: 4px; outline: none; }

        /* ---------- Estilos de Secciones ---------- */
        .container{ max-width:1100px; margin:0 auto; padding:28px 16px 80px; position:relative; z-index:1; }
        .text-card { max-width: 820px; margin: 20px auto 30px; padding: 20px; border-radius: var(--rounded); background: var(--glass-strong); box-shadow: var(--card-shadow); backdrop-filter: blur(6px); }
        .hidden-section { opacity: 0; transform: translateY(30px); transition: 1s ease-out; }
        .hidden-section.visible { opacity: 1; transform: none; }
        .type-me { opacity: 0; transition: opacity 0.3s; }
        .type-me.visible { opacity: 1; }
        .typewriter-cursor { border-right: 2px solid var(--accent); animation: blink 0.7s infinite; }
        @keyframes blink { 50% { border-color: transparent; } }

        /* --- Post-its --- */
        .postit-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 30px 0; }
        .postit { width: 160px; padding: 15px; background: #fff9c4; box-shadow: 3px 3px 10px rgba(0,0,0,0.1); font-size: 0.9rem; transform: rotate(-2deg); transition: 0.3s; color: #5d4037; border-bottom-right-radius: 40px 5px; font-weight: 600; text-align: center; }
        .postit:nth-child(even) { transform: rotate(2deg); background: #f1f8e9; }

        /* --- Rasca y Gana --- */
        .scratch-section { margin: 40px auto; max-width: 400px; text-align: center; }
        #scratch-container { position: relative; width: 300px; height: 150px; margin: 0 auto; border-radius: 15px; overflow: hidden; background: #fff; box-shadow: var(--card-shadow); border: 2px solid var(--accent); }
        #scratch-canvas { position: absolute; top: 0; left: 0; cursor: crosshair; touch-action: none; z-index: 10; }
        .scratch-content { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 20px; position: relative; z-index: 1; }

        /* --- Carruseles & Collage --- */
        .carousel-stage{ position:relative; display:flex; align-items:center; justify-content:center; width: 100%; height:360px; overflow:hidden; }
        .slide{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; opacity:0; transition: 0.8s ease; }
        .slide.active{ opacity:1; }
        .slide img{ max-width:100%; max-height:100%; object-fit:contain; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.12); }
        .collage-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); grid-gap: 8px; }
        .collage-item img { width: 100%; border-radius: 15px; transition: 0.3s; cursor: pointer; }
        
        /* Perspectivas AB */
        #perspectiveStage .slide > div { display: flex; flex-direction: column; gap: 8px; width: 100%; height: 100%; }
        #perspectiveStage .slide img { width: 100% !important; height: calc(50% - 4px) !important; object-fit: cover; border-radius: 12px; }

        /* --- Bot√≥n Corazones --- */
        #loveButton { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: var(--accent); border: 4px solid white; font-size: 30px; z-index: 9999; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .floating-heart { position: fixed; pointer-events: none; z-index: 10000; font-size: 24px; animation: flyUp 2s forwards ease-out; }
        @keyframes flyUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-250px) translateX(var(--random-x)) rotate(var(--random-deg)); opacity: 0; } }
    </style>
</head>
<body>
    <div id="progressBar"></div> 
    <div id="emoji-bg"></div>

    <div id="loader"> 
        <span>üíö</span> 
        <div style="font-weight:600; color:#388E3C">Cargando tu regalo...</div> 
    </div>

    <div id="confirm"> 
        <div class="confirm-card"> 
            <h2>√Åbreme si eres la ni√±a guapa, lista, agradable, amable, cari√±osa, te gustan los takis y tienes el novio mas suertudo del mundo por tenerte (SI T√ö, CARLOTA DUR√ÅN GARC√çA.) üíö</h2> 
            
            <div class="compact-player"> 
                <div class="cover-wrap"> 
                    <img src="images/portada.JPG"> 
                    <div class="play-circle" id="msgBtn">‚ñ∂</div>
                </div> 
                <div class="player-meta"> 
                    <div style="font-weight:700; font-size: 0.9rem;">Tienes un mensajitoooo</div> 
                    <div style="font-size:0.8rem;"><span id="mCur">0:00</span> / <span id="mDur">0:00</span></div> 
                    <div class="small-progress"><input id="mProg" type="range" min="0" max="100" value="0"></div> 
                </div> 
            </div> 

            <button id="openBtn">Abrir</button> 
        </div> 
    </div>

    <div class="container" id="mainContent" style="display:none;"> 
        <div class="player-wrapper">
            <div class="compact-player"> 
                <div class="cover-wrap"> 
                    <img src="images/portada.JPG"> 
                    <div class="play-circle" id="mainPlayBtn">‚ñ∂</div>
                </div> 
                <div class="player-meta"> 
                    <div style="font-weight:700; font-size: 0.9rem;">Nuestra m√∫sica ü•π</div> 
                    <div style="font-size:0.8rem;"><span id="tCur">0:00</span> / <span id="tDur">0:00</span></div> 
                    <div class="small-progress"><input id="tProg" type="range" min="0" max="100" value="0"></div> 
                </div> 
            </div> 
        </div>

        <div class="title-wrap hidden-section" id="titleSection"> 
            <h1 style="text-align: center;">¬øTe cre√≠as que el concierto era lo √∫nico? Sabes lo tonto que soy... espero que te guste MUCHO</h1> 
        </div>

        <div class="text-card"> 
            <p class="message">Hola mi esquiadora favorita, te echo de menos pero hoy es un d√≠a S√öPER ESPECIAL...</p> 
            <p class="message">Llevo los 6 meses que llevamos juntos y los 7 desde que conoc√≠ a la persona mas importante de todas queri√©ndote MUCHO. </p> 
            
            <div id="razones">
                <p class="message type-me">1. Porque contigo puedo ser realmente yo, y me sacas una sonrisa hasta cuando nadie puede.</p> 
                <p class="message type-me">2. Porque tienes el alma m√°s pura que he visto nunca.</p> 
                <p class="message type-me">3. Porque me haces la persona m√°s feliz del mundo y estoy muy orgulloso de ti ‚ù§Ô∏è</p> 
                <p class="message type-me">4. Porque dia a dia te esfuerzas por hacer y decir cosas que no te apetecen o no son lo que m√°s quieres ü•π‚ù§Ô∏è</p> 
                <p class="message type-me">5. Porque me incluyes en todo y me haces sentirme DEMASIADO c√≥modo. üòÅüòá‚ù§Ô∏èüòã</p> 
                <p class="message type-me">6. Porque si tengo que aprender de alguien, es de ti. Eres la hermana que todo hermano querr√≠a tener, la hija que todo padre y la nieta que todo abuelo.</p> 
                <p class="message type-me">7. Porque eres 1/1 y mi suerte no se puede medir. Gracias por incluirme en tu familia ‚ù§Ô∏è</p> 
                <p class="message type-me">8. Porque siempre sacas lo mejor de m√≠ y me valoras mucho.</p> 
                <p class="message type-me">9. Porque no solo eres mi novia, sino que tambi√©n mi mejor amiga.</p> 
                <p class="message type-me">10. Porque gracias a ti, el problema de sobrepensarlo todo va cada vez a menos. ü§ó‚ù§Ô∏è</p> 
                <p class="message type-me">11. Porque te admiro.</p> 
                <p class="message type-me">12. Porque cada detalle tuyo, por peque√±o que sea, me importa y mucho. üòÅ‚ù§Ô∏è</p> 
                <p class="message type-me">13. Porque cualquier d√≠a es autom√°ticamente bueno si voy a quedar contigo.</p> 
                <p class="message type-me">15. Amo como cantas y como te sabes todas las letras. Te quiero peque. üíö</p> 
                <p class="message type-me">14. No hay otra que me haga feliz como t√∫, ni que tenga tu sonrisa, ni tus ojos, ni tu fe. No hay nadie como t√∫.</p> 
            </div>

            <p class="message">GRACIAS. POR TODO. Por motivarme, calmarme y tenerme paciencia. Eres mi todo. Te QUIERO peque üíöüíöüíöüíö</p> 
        </div>

        <div class="postit-container hidden-section">
            <div class="postit">¬°Eres capaz de TODO lo que te propongas! ‚ú®</div>
            <div class="postit" style="background:#e1f5fe">6 meses y contando... üîí</div>
            <div class="postit">Me debes un baile en cuanto vuelvas üíÉ</div>
        </div>

        <div class="carousel hidden-section"> 
            <div class="arrow-left"><button id="prevBtn">‚Äπ</button></div> 
            <div class="carousel-stage" id="stage" onclick="openMainCarouselLightbox()">
                <div class="slide active"><img src="images/IMG_8777.jpeg"></div><div class="slide"><img src="images/IMG_7604.jpeg"></div><div class="slide"><img src="images/IMG_7567.jpeg"></div><div class="slide"><img src="images/IMG_7372.jpeg"></div><div class="slide"><img src="images/IMG_5003.jpeg"></div><div class="slide"><img src="images/IMG_1427.jpeg"></div><div class="slide"><img src="images/f52fc0bf-7153-43cc-abdc-201a14e7431c.jpeg"></div><div class="slide"><img src="images/f051fdc8-7e2a-46e3-a65c-d632f135f325.jpeg"></div><div class="slide"><img src="images/bc9a39ed-631b-43f8-9a86-ca373ff34698.jpeg"></div><div class="slide"><img src="images/IMG_1204.jpeg"></div><div class="slide"><img src="images/IMG_1113.jpeg"></div><div class="slide"><img src="images/a35975e2-9ba2-42fe-8fdf-ab06c0f87336.jpeg"></div><div class="slide"><img src="images/IMG_1097.jpeg"></div><div class="slide"><img src="images/894dc007-6d33-4bd4-bef9-0f419769eb58.jpeg"></div><div class="slide"><img src="images/7fa3e78a-31ea-4964-b4c9-bf778241b46a.jpeg"></div><div class="slide"><img src="images/3dafce51-cfde-4746-9112-f214c3e11876.jpeg"></div><div class="slide"><img src="images/31f14a18-3ecf-466d-97f6-350c24dbdbc5.jpeg"></div><div class="slide"><img src="images/IMG_0991.jpeg"></div><div class="slide"><img src="images/IMG_0951.jpeg"></div><div class="slide"><img src="images/IMG_0594.jpeg"></div><div class="slide"><img src="images/IMG_0567.jpeg"></div><div class="slide"><img src="images/IMG_0411.jpeg"></div><div class="slide"><img src="images/IMG_0056.jpeg"></div><div class="slide"><img src="images/IMG_24_FIX.jpeg"></div><div class="slide"><img src="images/24f8cb99-1774-441a-9c2a-ba494afdbec9.jpeg"></div>
            </div> 
            <div class="arrow-right"><button id="nextBtn">‚Ä∫</button></div> 
            <div class="carousel-dots" id="carouselDots"></div>
        </div>

        <div class="collage-section hidden-section">
            <h2 style="text-align: center;">Appreciation "post" con fotos que adoro ü´∂</h2>
            <div class="collage-grid" id="photoCollage">
                <div class="collage-item"><img src="images/collage1.jpg"></div><div class="collage-item"><img src="images/collage2.jpg"></div><div class="collage-item"><img src="images/collage3.jpg"></div><div class="collage-item"><img src="images/collage4.jpg"></div><div class="collage-item"><img src="images/collage5.jpg"></div><div class="collage-item"><img src="images/collage6.jpg"></div><div class="collage-item"><img src="images/collage7.jpg"></div><div class="collage-item"><img src="images/collage8.jpg"></div><div class="collage-item"><img src="images/collage9.jpg"></div><div class="collage-item"><img src="images/collage10.jpg"></div><div class="collage-item"><img src="images/collage11.jpg"></div><div class="collage-item"><img src="images/collage12.jpg"></div><div class="collage-item"><img src="images/collage13.jpg"></div><div class="collage-item"><img src="images/collage14.jpg"></div><div class="collage-item"><img src="images/collage15.jpg"></div><div class="collage-item"><img src="images/collage16.jpg"></div><div class="collage-item"><img src="images/collage17.jpg"></div><div class="collage-item"><img src="images/collage18.jpg"></div><div class="collage-item"><img src="images/collage19.jpg"></div><div class="collage-item"><img src="images/collage20.jpg"></div><div class="collage-item"><img src="images/collage21.jpg"></div><div class="collage-item"><img src="images/collage22.JPG"></div><div class="collage-item"><img src="images/collage23.jpg"></div><div class="collage-item"><img src="images/collage24.jpg"></div><div class="collage-item"><img src="images/collage25.PNG"></div><div class="collage-item"><img src="images/collage26.jpg"></div><div class="collage-item"><img src="images/collage27.JPG"></div><div class="collage-item"><img src="images/collage28.jpg"></div><div class="collage-item"><img src="images/collage29.jpg"></div><div class="collage-item"><img src="images/collage30.jpg"></div>
            </div>
        </div>

        <div class="scratch-section hidden-section">
            <h2 style="text-align: center;">Tengo otra sorpresaaaaaa... (¬°Rasca aqu√≠!) üöÅ</h2>
            <div id="scratch-container">
                <div class="scratch-content">
                    <p style="font-weight: 900; color: var(--accent-dark); margin: 0; font-size: 1.2rem;">¬°DRONE DroneArt Show TICKETS! üåå</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">Tenemos d√≠a a elegir! (a ver si podemos los dos) ‚ù§Ô∏è</p>
                </div>
                <canvas id="scratch-canvas" width="300" height="150"></canvas>
            </div>
        </div>

        <div class="counter-section hidden-section">
            <div class="counter-card">
                <div class="fun-fact-text">Llevamos juntos: </div> 
                <div id="contador"></div> 
            </div>
            <div class="text-card" style="text-align: center; max-width: 500px; margin: 20px auto;">
                <p class="message" style="margin: 0;">185 d√≠as, 26 semanas, 6 meses... <br> <strong>15.897.600 segundos</strong> en los que has pasado por mi mente cada uno de ellos. üíö</p>
            </div>
        </div>

        <div class="timeline-wrapper hidden-section"> 
            <div class="text-card">
                <div class="timeline" id="timeline"> 
                    <div class="event"><div class="dot"></div><div><div class="date">31 de Mayo 2025</div><div class="desc">Te conoc√≠ (lo mejor que me ha pasado)</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">3 de Junio 2025</div><div class="desc">Primera cita</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">2 de Julio 2025</div><div class="desc">Empezamos a salir oficialmente.</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">30 de Octubre 2025</div><div class="desc">LONDON! Nuestro primer viaje</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">2 de Diciembre 2025</div><div class="desc">5 MESES!</div></div></div>
                </div> 
            </div>
        </div> 

        <div class="carousel hidden-section" id="perspectiveSlider">
            <h2 style="text-align: center; margin-bottom: 25px;">Perspectivas üòÅ</h2>
            <div class="arrow-left"><button id="prevPerspectiveBtn">‚Äπ</button></div> 
            <div class="carousel-stage" id="perspectiveStage"> 
                <div class="slide active"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB1-1.jpg"><img src="images/AB1-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB2-1.jpg"><img src="images/AB2-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB3-1.jpg"><img src="images/AB3-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB4-1.jpg"><img src="images/AB4-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB5-1.jpg"><img src="images/AB5-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB6-1.jpg"><img src="images/AB6-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB7-1.jpg"><img src="images/AB7-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB8-1.jpg"><img src="images/AB8-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB9-1.jpg"><img src="images/AB9-2.jpg"></div></div>
                <div class="slide"><div onclick="openCurrentPerspectiveLightbox()"><img src="images/AB10-1.jpg"><img src="images/AB10-2.jpg"></div></div>
            </div> 
            <div class="arrow-right"><button id="nextPerspectiveBtn">‚Ä∫</button></div> 
        </div>

        <div class="final-message-card hidden-section">
            Casi dos meses d√°ndole forma a esto... espero que te haya gustado. <br> Ma√±ana te toca esquiar, ¬°disfruta mucho peque√±a! Te amo. ‚ù§Ô∏è
        </div>
    </div>
    
    <div id="lightbox" class="lightbox" onclick="this.style.display='none'"><img class="lightbox-content" id="lightboxImage"></div>
    <div id="dualLightbox" class="lightbox" onclick="this.style.display='none'">
        <div style="display:flex; flex-direction:column; gap:10px; width:90%; align-items:center;">
            <img id="dualImageA" style="max-height:45vh; border-radius:10px;"><img id="dualImageB" style="max-height:45vh; border-radius:10px;">
        </div>
    </div>

    <button id="loveButton">üíö</button>

    <script> 
        /* --- CONFIGURACI√ìN DE AUDIO --- */
        const svgPlay='‚ñ∂', svgPause='‚è∏';
        const messageAudio = new Audio("images/mensaje.mp3"); 
        const audio = new Audio("images/musica.mp3");

        function hapticFeedback(duration = 50) { if ('vibrate' in navigator) navigator.vibrate(duration); }
        function fmt(s){ if(!isFinite(s)) return '0:00'; const m=Math.floor(s/60),sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }

        /* --- TYPEWRITER --- */
        function typeWriter(element, text, speed = 40) {
            let i = 0; element.innerHTML = ""; element.classList.add('typewriter-cursor');
            function type() {
                if (i < text.length) { element.innerHTML += text.charAt(i); i++; setTimeout(type, speed); }
                else { element.classList.remove('typewriter-cursor'); }
            }
            type();
        }
        const typeObs = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.classList.contains('typed')) {
                    entry.target.classList.add('typed','visible');
                    typeWriter(entry.target, entry.target.innerText);
                }
            });
        }, { threshold: 0.1 });

        /* --- RASCA Y GANA --- */
        function initScratch() {
            const can = document.getElementById('scratch-canvas'), ctx = can.getContext('2d');
            if(!can) return;
            ctx.fillStyle = '#66BB6A'; ctx.fillRect(0, 0, 300, 150); ctx.fillStyle = '#fff'; ctx.font = '20px Quicksand'; ctx.textAlign = 'center'; ctx.fillText('¬°RASCA AQU√ç! üëÜ', 150, 85);
            let drawing = false;
            function scratch(e) { if(!drawing) return; const rect = can.getBoundingClientRect(), x = (e.clientX || e.touches[0].clientX) - rect.left, y = (e.clientY || e.touches[0].clientY) - rect.top; ctx.globalCompositeOperation = 'destination-out'; ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI * 2); ctx.fill(); }
            can.addEventListener('mousedown', () => drawing = true); can.addEventListener('touchstart', () => drawing = true); window.addEventListener('mouseup', () => drawing = false); can.addEventListener('mousemove', scratch); can.addEventListener('touchmove', scratch);
        }

        /* --- LLUVIA DE CORAZONES --- */
        document.getElementById('loveButton').onclick = (ev) => {
            hapticFeedback(100);
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div'); heart.className = 'floating-heart'; heart.innerHTML = 'üíö';
                const x = ev.clientX || window.innerWidth - 50; const y = ev.clientY || window.innerHeight - 50;
                heart.style.left = x + 'px'; heart.style.top = y + 'px';
                heart.style.setProperty('--random-x', (Math.random() * 200 - 100) + 'px');
                heart.style.setProperty('--random-deg', (Math.random() * 360) + 'deg');
                document.body.appendChild(heart); setTimeout(() => heart.remove(), 2000);
            }
        };

        /* --- CONTADOR --- */
        const startDate=new Date('2025-07-02T00:00:00+02:00');
        function updateCounter() {
            const diff = Math.floor((new Date() - startDate) / 1000);
            const d = Math.floor(diff/86400), h = Math.floor((diff%86400)/3600), m = Math.floor((diff%3600)/60), s = diff%60;
            document.getElementById('contador').innerHTML = `<div class="counter-wrap"><span class="counter-digit-group">${d}d</span> <span class="counter-digit-group">${h}h</span> <span class="counter-digit-group">${m}m</span> <span class="counter-digit-group">${s}s</span></div>`;
        }

        /* --- AUDIO LOGIC --- */
        function setupAudio(aud, btn, prog, cur, dur, isMsg) {
            btn.onclick = () => { hapticFeedback(80); if(aud.paused){ aud.play(); btn.innerHTML='‚è∏'; if(isMsg) audio.pause(); } else { aud.pause(); btn.innerHTML='‚ñ∂'; } };
            aud.ontimeupdate = () => { if(!aud.duration)return; prog.value = (aud.currentTime/aud.duration)*100; cur.textContent = fmt(aud.currentTime); };
            aud.onloadedmetadata = () => dur.textContent = fmt(aud.duration);
            prog.oninput = () => aud.currentTime = (prog.value/100)*aud.duration;
        }

        /* --- INICIO --- */
        document.getElementById('openBtn').onclick = () => {
            hapticFeedback(150); messageAudio.pause();
            document.getElementById('confirm').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('titleSection').classList.add('visible'); 
            initScratch();
            document.querySelectorAll('.hidden-section, .event').forEach(s => genObs.observe(s));
            document.querySelectorAll('.type-me').forEach(t => typeObs.observe(t));
            window.scrollTo(0,0);
        };
        const genObs = new IntersectionObserver(es => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); }), { threshold: 0.1 });

        window.onload = () => {
            setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1500);
            setInterval(updateCounter, 1000);
            setupAudio(messageAudio, document.getElementById('msgBtn'), document.getElementById('mProg'), document.getElementById('mCur'), document.getElementById('mDur'), true);
            setupAudio(audio, document.getElementById('mainPlayBtn'), document.getElementById('tProg'), document.getElementById('tCur'), document.getElementById('tDur'), false);
            const bg = document.getElementById('emoji-bg');
            for(let i=0; i<35; i++){
                const e = document.createElement('div'); e.className='emoji'; e.textContent = i%2===0?'üíö':'üíñ';
                e.style.left=Math.random()*100+'%'; e.style.setProperty('--random-duration', Math.random()*10+'s'); bg.appendChild(e);
            }
        };

        /* --- CARRUSELES --- */
        function initCarousel(id, prev, next, isMain) {
            let cur = 0; const slides = document.querySelectorAll(`#${id} .slide`);
            const show = (i) => { cur = (i + slides.length) % slides.length; slides.forEach((s,x) => s.classList.toggle('active', x === cur)); if(isMain) updateDots(cur); };
            document.getElementById(prev).onclick = () => { hapticFeedback(50); show(cur-1); };
            document.getElementById(next).onclick = () => { hapticFeedback(50); show(cur+1); };
            if(isMain) {
                const dots = document.getElementById('carouselDots');
                slides.forEach((_, i) => { const d = document.createElement('div'); d.className = 'dot' + (i===0?' active':''); d.onclick = () => show(i); dots.appendChild(d); });
            }
        }
        function updateDots(idx) { document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === idx)); }
        initCarousel('stage', 'prevBtn', 'nextBtn', true);
        initCarousel('perspectiveStage', 'prevPerspectiveBtn', 'nextPerspectiveBtn', false);

        function openMainCarouselLightbox() { const img = document.querySelector('#stage .slide.active img'); document.getElementById('lightboxImage').src = img.src; document.getElementById('lightbox').style.display='flex'; }
        function openCurrentPerspectiveLightbox() { const imgs = document.querySelector('#perspectiveStage .slide.active').querySelectorAll('img'); document.getElementById('dualImageA').src = imgs[0].src; document.getElementById('dualImageB').src = imgs[1].src; document.getElementById('dualLightbox').style.display='flex'; }
        document.querySelectorAll('#photoCollage img').forEach(img => img.onclick = () => { document.getElementById('lightboxImage').src = img.src; document.getElementById('lightbox').style.display='flex'; });
        window.onscroll = () => { const s = document.documentElement.scrollTop, h = document.documentElement.scrollHeight - document.documentElement.clientHeight; document.getElementById('progressBar').style.width = (s/h)*100 + "%"; };
    </script>
</body>
</html>
