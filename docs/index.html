<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Los mejores 6 meses de mi vida</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        /* ---------- Variables y reset ---------- */
        :root{
            --bg: #F1F8E9; /* Verde Matcha clarito */
            --accent: #66BB6A; /* Verde principal */
            --accent-dark: #388E3C;
            --text: #1B5E20; 
            --glass: rgba(255, 255, 255, 0.7);
            --glass-strong: rgba(255, 255, 255, 0.95);
            --card-shadow: 0 8px 32px rgba(102, 187, 106, 0.15);
            --rounded: 20px;
            --green-shadow: rgba(76, 175, 80, 0.3);
        }
        *{box-sizing:border-box}
        html,body{height:100%; overflow-x:hidden;}
        body{ 
            margin:0; 
            font-family: 'Quicksand', Inter, "Segoe UI", Roboto, Arial, sans-serif; 
            background: var(--bg); 
            color:var(--text); 
            -webkit-font-smoothing:antialiased; 
            -moz-osx-font-smoothing:grayscale; 
            -webkit-touch-callout:none; 
        }
        
        /* ---------- BARRA DE PROGRESO DE LECTURA ---------- */
        #progressBar {
            position: fixed; top: 0; left: 0; height: 4px; 
            background: linear-gradient(90deg, #ff6b6b, var(--accent)); 
            width: 0%; z-index: 10000; transition: width 0.1s linear; 
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        
        /* ---------- Bot√≥n Lluvia de Amor (iPhone) ---------- */
        #loveButton {
            position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px;
            border-radius: 50%; background: var(--accent); border: 4px solid white;
            font-size: 32px; z-index: 9999; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            -webkit-tap-highlight-color: transparent; transition: transform 0.2s;
        }
        #loveButton:active { transform: scale(0.9); }

        .floating-heart {
            position: fixed; pointer-events: none; z-index: 10000; font-size: 24px;
            animation: flyUp 2s forwards ease-out;
        }
        @keyframes flyUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-200px) translateX(var(--random-x)) rotate(var(--random-deg)); opacity: 0; }
        }

        /* ---------- Typewriter Styling ---------- */
        .type-me { opacity: 0; }
        .type-me.visible { opacity: 1; }
        .typewriter-cursor::after {
            content: '|'; color: var(--accent); animation: blink 0.7s infinite; margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* ---------- Rasca y Gana ---------- */
        .scratch-section { margin: 40px auto; max-width: 400px; text-align: center; }
        #scratch-container {
            position: relative; width: 300px; height: 150px; margin: 0 auto;
            border-radius: 15px; overflow: hidden; background: #fff;
            box-shadow: var(--card-shadow);
        }
        #scratch-canvas { position: absolute; top: 0; left: 0; cursor: crosshair; touch-action: none; }
        .scratch-content {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; padding: 10px; text-align: center;
        }

        /* ---------- Post-its ---------- */
        .postit-container {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin: 40px 0;
        }
        .postit {
            width: 180px; padding: 15px; background: #fff9c4; box-shadow: 5px 5px 10px rgba(0,0,0,0.1);
            font-size: 0.9rem; transform: rotate(-2deg); transition: 0.3s;
            color: #5d4037; border-bottom-right-radius: 30px 5px;
        }
        .postit:nth-child(even) { transform: rotate(2deg); background: #f1f8e9; }
        .postit:hover { transform: scale(1.05) rotate(0deg); }

        /* ---------- Fondo emojis ---------- */
        #emoji-bg{ position:fixed; inset:0; z-index:-3; pointer-events:none; overflow:hidden; }
        .emoji{ position:absolute; opacity:0.07; font-size: calc(14px + 1.4vw); animation: float linear infinite; }
        @keyframes float{ from{ transform: translateY(110vh) rotate(0deg); } to{ transform: translateY(-10vh) rotate(360deg); } }

        /* ---------- Loader ---------- */
        #loader{ position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(180deg,rgba(255,255,255,0.98),var(--bg)); z-index:9999; transition: opacity .5s ease, visibility .5s; }
        #loader.hidden{ opacity:0; visibility:hidden; }

        /* ---------- Confirm Section ---------- */
        #confirm{ position:fixed; inset:0; display:grid; place-items:center; z-index:9998; padding: 20px; background: var(--bg); }
        .confirm-card{ width:100%; max-width:520px; border-radius:18px; padding:18px; background: var(--glass-strong); box-shadow:var(--card-shadow); backdrop-filter:blur(6px); display:flex; flex-direction:column; gap:12px; align-items:center; }
        .confirm-card h2 { text-align: center; }
        #openBtn { padding: 10px 30px; font-size: 1.2rem; font-weight: 700; border-radius: 8px; border: none; background: var(--accent); color: white; cursor: pointer; transition: 0.2s; }
        #openBtn:hover { background: var(--accent-dark); }

        /* ---------- Players ---------- */
        .player-wrapper{ display:flex; justify-content:center; margin-bottom: 20px; }
        .compact-player{ display:flex; align-items:center; gap:12px; width:100%; max-width: fit-content; padding: 10px 20px; border-radius: var(--rounded); background: var(--glass-strong); box-shadow: var(--card-shadow); }
        .cover-wrap{ position:relative; width:64px; height:64px; border-radius:10px; overflow:hidden; box-shadow:0 8px 20px rgba(0,0,0,0.12); }
        .cover-wrap img{ width:100%; height:100%; object-fit:cover; }
        .play-circle{ width:36px; height:36px; border-radius:50%; display:grid; place-items:center; background:rgba(255,255,255,0.2); border:2px solid white; cursor:pointer; }

        /* ---------- Container & Cards ---------- */
        .container{ max-width:1100px; margin:0 auto; padding:28px 16px 80px; position:relative; z-index:1; }
        .title-wrap{ text-align:center; margin:10px 0 28px; }
        h1{ font-size:3em; margin:0; line-height:1.05; color: var(--text); }
        .text-card { max-width: 820px; margin: 20px auto 30px; padding: 20px; border-radius: var(--rounded); background: var(--glass-strong); box-shadow: var(--card-shadow); backdrop-filter: blur(6px); }
        p.message{ font-size:1.1rem; color: var(--text); margin:14px 0; line-height: 1.5; }

        /* ---------- Carousel ---------- */
        .carousel{ width:100%; max-width:820px; margin:10px auto 28px; position:relative; display: flex; flex-direction: column; align-items: center; }
        .carousel-stage{ position:relative; display:flex; align-items:center; justify-content:center; width: 100%; height:360px; overflow:hidden; touch-action: pan-y; }
        .slide{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; opacity:0; transition: opacity .8s ease; }
        .slide.active{ opacity:1; }
        .slide img{ max-width:100%; max-height:100%; object-fit:contain; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.12); }

        .arrow button{ background:var(--glass-strong); border-radius:50%; border:none; width:44px; height:44px; cursor:pointer; box-shadow:var(--card-shadow); }
        .arrow-left{ position:absolute; top:50%; left:6px; transform:translateY(-50%); z-index: 10; }
        .arrow-right{ position:absolute; top:50%; right:6px; transform:translateY(-50%); z-index: 10; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(0,0,0,0.2); transition: 0.3s; cursor: pointer; flex-shrink: 0; }
        .dot.active { background: var(--accent); transform: scale(1.2); }

        /* ---------- Collage Grid ---------- */
        .collage-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); grid-gap: 4px; }
        .collage-item img { width: 100%; height: auto; border-radius: var(--rounded); box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.3s; }
        .collage-item img:hover { transform: scale(1.05) !important; }

        /* ---------- Contador ---------- */
        .counter-card{ width: 100%; max-width: 400px; text-align:center; padding: 20px 10px; border-radius: var(--rounded); background: var(--glass-strong); box-shadow: var(--card-shadow); margin: 0 auto; }
        .counter-digit-group { font-size: 1.8rem; color: var(--accent); font-weight: 900; }
        .label { font-size: 0.8rem; opacity: 0.6; }

        /* ---------- Timeline ---------- */
        .timeline { display: flex; flex-direction: column; gap: 12px; }
        .event { background: white; border-radius: 12px; padding: 12px 14px; box-shadow: var(--card-shadow); border-left: 4px solid var(--accent); opacity: 0; transform: translateY(20px); transition: 0.5s; }
        .event.visible { opacity: 1; transform: none; }

        /* ---------- Lightboxes ---------- */
        .lightbox { display: none; position: fixed; z-index: 10001; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        .lightbox-content { max-width: 90%; max-height: 80vh; border-radius: 12px; }
        .lightbox-close { position: absolute; top: 15px; right: 35px; color: #fff; font-size: 40px; cursor: pointer; }

        .hidden-section { opacity: 0; transform: translateY(30px); transition: 1s ease-out; }
        .hidden-section.visible { opacity: 1; transform: none; }
    </style>
</head>
<body>
    <div id="progressBar"></div> 
    <div id="emoji-bg"></div>
    <button id="loveButton">üíö</button>

    <div id="loader"> 
        <span>üíö</span> 
        <div style="font-weight:600;color: var(--accent-dark)">Cargando algo hecho por tu novio...</div> 
    </div>

    <div id="confirm"> 
        <div class="confirm-card"> 
            <h2>√Åbreme si eres la ni√±a guapa, lista, agradable, amable, cari√±osa, te gustan los takis y tienes el novio mas suertudo del mundo por tenerte... üíö</h2> 
            <div class="compact-player"> 
                <div class="cover-wrap" id="messageCoverWrapConfirm"> 
                    <img src="images/portada.JPG" alt="Portada"> 
                    <div class="play-circle" id="messagePlayOverlayConfirm"></div>
                </div> 
                <div class="player-meta"> 
                    <div class="player-title">Tienes un mensajitoooo</div> 
                    <div class="player-time"><span id="messageTimeCurC">0:00</span> / <span id="messageTimeDurC">0:00</span></div> 
                    <div class="small-progress"><input id="messageProgressC" type="range" min="0" max="100" value="0"></div> 
                </div> 
            </div> 
            <button id="openBtn">Abrir</button> 
        </div> 
    </div>

    <div class="container" id="mainContent" style="display:none;"> 
        <div class="player-wrapper">
            <div class="compact-player"> 
                <div class="cover-wrap" id="coverWrapMain"> 
                    <img src="images/portada.JPG" alt="Portada"> 
                    <div class="play-circle" id="playOverlayMain"></div>
                </div> 
                <div class="player-meta"> 
                    <div class="player-title">Nuestra m√∫sica ü•π</div> 
                    <div class="player-time"><span id="timeCurM">0:00</span> / <span id="timeDurM">0:00</span></div> 
                    <div class="small-progress"><input id="progressM" type="range" min="0" max="100" value="0"></div> 
                </div> 
            </div> 
        </div>

        <div class="title-wrap hidden-section" id="titleSection"> 
            <h1>¬øTe cre√≠as que el concierto era lo √∫nico que iba a regalarte? Espero que te guste MUCHO</h1> 
        </div>

        <div class="text-card" id="reasonsCard"> 
            <p class="message">Hola mi esquiadora favorita, te echo mucho de menos pero hoy es un d√≠a S√öPER ESPECIAL...</p>
            <p class="message">Por desgracia estamos a unos 615km pero gracias a que tenemos internet y tu a un novio ingeniero pesado...</p>

            <p class="message type-me">1. Porque contigo puedo ser realmente yo, y me sacas una sonrisa hasta cuando nadie puede hacerme sonre√≠r</p> 
            <p class="message type-me">2. Porque tienes el alma m√°s pura que he visto nunca, y todo lo haces con una sonrisa que alegra hasta el peor de los d√≠as</p> 
            <p class="message type-me">3. Porque me haces la persona m√°s feliz del mundo y estoy muy orgulloso de ti ‚ù§Ô∏è</p> 
            <p class="message type-me">4. Porque dia a dia te esfuerzas por hacer y decir cosas que no te apetecen o no son lo que m√°s quieres ü•π‚ù§Ô∏è</p> 
            <p class="message type-me">5. Porque me incluyes en todo y me haces sentirme DEMASIADO c√≥modo y feliz en todo momento que paso contigoüòÅüòá‚ù§Ô∏èüòã</p> 
            <p class="message type-me">6. Porque si tengo que aprender de alguien, es de ti. Eres la hermana que todo hermano querr√≠a tener...</p> 
            <p class="message type-me">7. Porque ahora que me he parado a pensarlo, mi suerte no es nada de 1 entre 1.000.000. Eres 1/1 y eso demuestra que no puedo tener mucha m√°s suerte ‚ù§Ô∏è</p> 
            <p class="message type-me">8. Porque siempre sacas lo mejor de m√≠ y me valoras mucho. Porque haces hasta las cosas que menos pueden apetecerte...</p> 
            <p class="message type-me">9. Porque no solo eres mi novia, sino que tambi√©n mi mejor amiga y la persona con la que quiero hacerlo todo...</p> 
            <p class="message type-me">10. Porque gracias a ti, lo que me valoras y cuanto me haces saberlo para que me valore a m√≠ mismo, el problema de sobrepensarlo todo va cada vez a menos ü§ó‚ù§Ô∏è</p> 
            <p class="message type-me">11. Porque te admiro.</p> 
            <p class="message type-me">12. Porque no solo me duermo y me despierto pensando y hablandote, si no que tambi√©n me miro a la mu√±eca y veo un detalle que vale m√°s que mucho dinero üòÅ‚ù§Ô∏è</p> 
            <p class="message type-me">13. Porque cualquier d√≠a es autom√°ticamente bueno si estoy o voy a quedar contigo</p> 
            <p class="message type-me">15. Dos semanas mand√°ndote mensaje diario cutie. Fin? Jejeje. Siempre gracias pero ten√≠a que a√±adir hoy que amo como cantas ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</p> 
            <p class="message type-me">14. No empiezo por porque pero si que explico. Si he empezado estos mensajes as√≠ al principio pensaba que era para decirte luego en plan porque te quiero. Pero muy basic no? Otra, no me hace feliz. Otra, no me importa como haces t√∫... No me trata como me tratas t√∫. No me ayuda ni me tranquiliza como haces t√∫.</p> 

            <p class="message">Desde que empec√© a escribir todo han pasado cosa de dos meses... Te QUIERO peque üíö</p> 
        </div>

        <div class="postit-container hidden-section">
            <div class="postit">No olvides que eres capaz de TODO lo que te propongas ‚ú®</div>
            <div class="postit">Me debes un baile lento en cuanto vuelvas üíÉ</div>
            <div class="postit">Gracias por ser mi lugar seguro ‚öì</div>
            <div class="postit">Tu sonrisa es mi parte favorita del d√≠a üòä</div>
        </div>

        <div class="carousel hidden-section"> 
            <div class="arrow-left"><button id="prevBtn">‚Äπ</button></div> 
            <div class="carousel-stage" id="stage" onclick="openMainCarouselLightbox()">
                <div class="slide active"><img src="images/IMG_8777.jpeg" alt="1"></div> 
                <div class="slide"><img src="images/IMG_7604.jpeg" alt="2"></div> 
                <div class="slide"><img src="images/IMG_7567.jpeg" alt="3"></div> 
                <div class="slide"><img src="images/IMG_7372.jpeg" alt="4"></div> 
                <div class="slide"><img src="images/IMG_5003.jpeg" alt="5"></div> 
                <div class="slide"><img src="images/IMG_1427.jpeg" alt="6"></div> 
                <div class="slide"><img src="images/f52fc0bf-7153-43cc-abdc-201a14e7431c.jpeg" alt="7"></div> 
                <div class="slide"><img src="images/f051fdc8-7e2a-46e3-a65c-d632f135f325.jpeg" alt="8"></div> 
                <div class="slide"><img src="images/bc9a39ed-631b-43f8-9a86-ca373ff34698.jpeg" alt="9"></div> 
                <div class="slide"><img src="images/IMG_1204.jpeg" alt="10"></div> 
                <div class="slide"><img src="images/IMG_1113.jpeg" alt="11"></div> 
                <div class="slide"><img src="images/a35975e2-9ba2-42fe-8fdf-ab06c0f87336.jpeg" alt="12"></div> 
                <div class="slide"><img src="images/IMG_1097.jpeg" alt="13"></div> 
                <div class="slide"><img src="images/894dc007-6d33-4bd4-bef9-0f419769eb58.jpeg" alt="14"></div> 
                <div class="slide"><img src="images/7fa3e78a-31ea-4964-b4c9-bf778241b46a.jpeg" alt="15"></div> 
                <div class="slide"><img src="images/3dafce51-cfde-4746-9112-f214c3e11876.jpeg" alt="16"></div> 
                <div class="slide"><img src="images/31f14a18-3ecf-466d-97f6-350c24dbdbc5.jpeg" alt="17"></div> 
                <div class="slide"><img src="images/IMG_0991.jpeg" alt="18"></div> 
                <div class="slide"><img src="images/IMG_0951.jpeg" alt="19"></div> 
                <div class="slide"><img src="images/IMG_0594.jpeg" alt="20"></div> 
                <div class="slide"><img src="images/IMG_0567.jpeg" alt="21"></div> 
                <div class="slide"><img src="images/IMG_0411.jpeg" alt="22"></div> 
                <div class="slide"><img src="images/IMG_0056.jpeg" alt="23"></div> 
                <div class="slide"><img src="images/IMG_24_FIX.jpeg" alt="24"></div> 
                <div class="slide"><img src="images/24f8cb99-1774-441a-9c2a-ba494afdbec9.jpeg" alt="25"></div> 
            </div> 
            <div class="arrow-right"><button id="nextBtn">‚Ä∫</button></div> 
            <div class="carousel-dots" id="carouselDots"></div>
        </div>

        <div class="collage-section hidden-section" id="collageSection">
            <h2 style="text-align: center; margin-bottom: 25px;">Appreciation "post" ü´∂</h2>
            <div class="collage-grid" id="photoCollage">
                <div class="collage-item"><img src="images/collage1.jpg" alt="1"></div>
                <div class="collage-item"><img src="images/collage2.jpg" alt="2"></div>
                <div class="collage-item"><img src="images/collage3.jpg" alt="3"></div>
                <div class="collage-item"><img src="images/collage4.jpg" alt="4"></div>
                <div class="collage-item"><img src="images/collage5.jpg" alt="5"></div>
                <div class="collage-item"><img src="images/collage6.jpg" alt="6"></div>
                <div class="collage-item"><img src="images/collage7.jpg" alt="7"></div>
                <div class="collage-item"><img src="images/collage8.jpg" alt="8"></div>
                <div class="collage-item"><img src="images/collage9.jpg" alt="9"></div>
                <div class="collage-item"><img src="images/collage10.jpg" alt="10"></div>
                <div class="collage-item"><img src="images/collage11.jpg" alt="11"></div>
                <div class="collage-item"><img src="images/collage12.jpg" alt="12"></div>
                <div class="collage-item"><img src="images/collage13.jpg" alt="13"></div>
                <div class="collage-item"><img src="images/collage14.jpg" alt="14"></div>
                <div class="collage-item"><img src="images/collage15.jpg" alt="15"></div>
                <div class="collage-item"><img src="images/collage16.jpg" alt="16"></div>
                <div class="collage-item"><img src="images/collage17.jpg" alt="17"></div>
                <div class="collage-item"><img src="images/collage18.jpg" alt="18"></div>
                <div class="collage-item"><img src="images/collage19.jpg" alt="19"></div>
                <div class="collage-item"><img src="images/collage20.jpg" alt="20"></div>
                <div class="collage-item"><img src="images/collage21.jpg" alt="21"></div>
                <div class="collage-item"><img src="images/collage22.JPG" alt="22"></div>
                <div class="collage-item"><img src="images/collage23.jpg" alt="23"></div>
                <div class="collage-item"><img src="images/collage24.jpg" alt="24"></div>
                <div class="collage-item"><img src="images/collage25.PNG" alt="25"></div>
                <div class="collage-item"><img src="images/collage26.jpg" alt="26"></div>
                <div class="collage-item"><img src="images/collage27.JPG" alt="27"></div>
                <div class="collage-item"><img src="images/collage28.jpg" alt="28"></div>
                <div class="collage-item"><img src="images/collage29.jpg" alt="29"></div>
                <div class="collage-item"><img src="images/collage30.jpg" alt="30"></div>
            </div>
        </div>

        <div class="scratch-section hidden-section">
            <h2 style="text-align: center;">Tengo una noticia... (¬°Rasca aqu√≠!) üöÅ</h2>
            <div id="scratch-container">
                <div class="scratch-content">
                    <p style="font-weight: 700; color: var(--accent-dark); margin: 0;">¬°ENTRADAS PARA EL DRONE SHOW! üåå</p>
                    <p style="font-size: 0.8rem;">S√© que se cancel√≥... ¬°pero vamos a ir en cuanto lo reprogramen! ‚ù§Ô∏è</p>
                </div>
                <canvas id="scratch-canvas" width="300" height="150"></canvas>
            </div>
        </div>

        <div class="counter-section hidden-section">
            <div class="counter-card">
                <div class="fun-fact-text">Llevamos saliendo:</div> 
                <div id="contador"></div> 
            </div>
        </div>

        <div class="timeline-wrapper hidden-section"> 
            <div class="text-card">
                <h3 style="text-align: center;">Nuestra historia</h3>
                <div class="timeline" id="timeline"> 
                    <div class="event"><div class="dot"></div><div><div class="date">31 de Mayo de 2025</div><div class="desc">Conoc√≠ a la persona m√°s importante (T√ö)</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">3 de Junio de 2025</div><div class="desc">Nuestra primera cita</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">9 de Junio de 2025</div><div class="desc">Tiki Tako y c√≥cteles</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">2 de Julio 2025</div><div class="desc">Empezamos a salir.</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">30 de Octubre 2025</div><div class="desc">VIAJE A LONDON!</div></div></div> 
                    <div class="event"><div class="dot"></div><div><div class="date">2 de Diciembre 2025</div><div class="desc">5 MESES!</div></div></div> 
                </div> 
            </div>
        </div> 

        <div class="final-message-card hidden-section">
            Te amo profundamente. Disfruta de la nieve, peque√±a. üíö
        </div>
    </div>
    
    <div id="lightbox" class="lightbox" onclick="closeLightbox()"><span class="lightbox-close">√ó</span><img class="lightbox-content" id="lightboxImage"></div>

    <script> 
        /* --- CONFIGURACI√ìN DE AUDIO --- */
        const svgPlay='<svg width="14" height="14" viewBox="0 0 24 24"><path d="M5 3v18l15-9z" fill="#fff"/></svg>'; 
        const svgPause='<svg width="14" height="14" viewBox="0 0 24 24"><rect x="6" y="5" width="4" height="14" fill="#fff"/><rect x="14" y="5" width="4" height="14" fill="#fff"/></svg>'; 
        const messageAudio = new Audio("images/mensaje.mp3"); 
        const audio = new Audio("images/musica.mp3");

        function hapticFeedback(duration = 50) { if ('vibrate' in navigator) navigator.vibrate(duration); }
        function fmt(s){ if(!isFinite(s)) return '0:00'; const m=Math.floor(s/60); const sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }

        /* --- TYPEWRITER LOGIC --- */
        function typeWriter(element, text, speed = 40) {
            let i = 0; element.innerHTML = ""; element.classList.add('typewriter-cursor');
            function type() {
                if (i < text.length) { element.innerHTML += text.charAt(i); i++; setTimeout(type, speed); }
                else { element.style.borderRight = "none"; }
            }
            type();
        }

        const typeObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.classList.contains('typed')) {
                    const text = entry.target.innerText;
                    entry.target.classList.add('typed');
                    entry.target.classList.add('visible');
                    typeWriter(entry.target, text);
                }
            });
        }, { threshold: 0.1 });

        /* --- LLUVIA DE AMOR --- */
        function spawnHearts(event) {
            hapticFeedback(100);
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div'); heart.className = 'floating-heart'; heart.innerHTML = 'üíö';
                const x = event.clientX || window.innerWidth - 50; const y = event.clientY || window.innerHeight - 50;
                heart.style.left = x + 'px'; heart.style.top = y + 'px';
                heart.style.setProperty('--random-x', (Math.random() * 200 - 100) + 'px');
                heart.style.setProperty('--random-deg', (Math.random() * 360) + 'deg');
                document.body.appendChild(heart); setTimeout(() => heart.remove(), 2000);
            }
        }
        document.getElementById('loveButton').onclick = spawnHearts;

        /* --- RASCA Y GANA --- */
        function initScratch() {
            const canvas = document.getElementById('scratch-canvas');
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#66BB6A'; ctx.fillRect(0, 0, 300, 150);
            ctx.fillStyle = '#fff'; ctx.font = '20px Quicksand'; ctx.textAlign = 'center'; ctx.fillText('¬°Rasca aqu√≠!', 150, 85);
            
            let isDrawing = false;
            function scratch(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath(); ctx.arc(x, y, 20, 0, Math.PI * 2); ctx.fill();
            }
            canvas.addEventListener('mousedown', () => isDrawing = true);
            canvas.addEventListener('touchstart', () => isDrawing = true);
            window.addEventListener('mouseup', () => isDrawing = false);
            window.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchmove', scratch);
        }

        /* --- L√ìGICA DE AUDIO (RESTAURADA) --- */
        function setMessagePlayingUI(play){ 
            document.getElementById('messageCoverWrapConfirm').classList.toggle('playing', play);
            document.getElementById('messagePlayOverlayConfirm').innerHTML = play ? svgPause : svgPlay;
        }
        function setMainPlayingUI(play){ 
            document.getElementById('coverWrapMain').classList.toggle('playing',play); 
            document.getElementById('playOverlayMain').innerHTML=play?svgPause:svgPlay; 
        }

        document.getElementById('messageCoverWrapConfirm').onclick = () => {
            hapticFeedback(80);
            if (messageAudio.paused) { messageAudio.play(); setMessagePlayingUI(true); audio.pause(); setMainPlayingUI(false); }
            else { messageAudio.pause(); setMessagePlayingUI(false); }
        };
        document.getElementById('coverWrapMain').onclick = () => {
            hapticFeedback(80);
            if (audio.paused) { audio.play(); setMainPlayingUI(true); messageAudio.pause(); setMessagePlayingUI(false); }
            else { audio.pause(); setMainPlayingUI(false); }
        };

        messageAudio.ontimeupdate = () => {
            document.getElementById('messageProgressC').value = (messageAudio.currentTime / messageAudio.duration) * 100;
            document.getElementById('messageTimeCurC').textContent = fmt(messageAudio.currentTime);
        };
        audio.ontimeupdate = () => {
            document.getElementById('progressM').value = (audio.currentTime / audio.duration) * 100;
            document.getElementById('timeCurM').textContent = fmt(audio.currentTime);
        };

        /* --- INICIO Y OBSERVERS --- */
        document.getElementById('openBtn').onclick = () => {
            hapticFeedback(150); messageAudio.pause();
            document.getElementById('confirm').style.display='none'; 
            document.getElementById('mainContent').style.display='block'; 
            document.getElementById('titleSection').classList.add('visible'); 
            initScratch();
            document.querySelectorAll('.hidden-section').forEach(s => generalObserver.observe(s));
            document.querySelectorAll('.type-me').forEach(t => typeObserver.observe(t));
        };

        const generalObserver = new IntersectionObserver((entries) => {
            entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
        }, { threshold: 0.1 });

        window.addEventListener('load',()=>{ 
            setTimeout(()=>document.getElementById('loader').classList.add('hidden'),1500); 
            const container = document.getElementById('emoji-bg'); 
            for(let i=0;i<35;i++){ 
                const e=document.createElement('div'); e.className='emoji'; e.textContent='üíö'; 
                e.style.left=Math.random()*100+'%'; e.style.setProperty('--random-duration', `${Math.random() * 10}s`); 
                e.style.setProperty('--random-delay', `${Math.random() * 10}s`); container.appendChild(e); 
            } 
        });

        /* --- CONTADOR --- */
        const startDate=new Date('2025-07-02T00:00:00+02:00');
        setInterval(() => {
            const diff = Math.floor((new Date() - startDate) / 1000);
            const d = Math.floor(diff / 86400);
            document.getElementById('contador').innerHTML = `<span class="counter-digit-group">${d} D√≠as</span>`;
        }, 1000);
    </script>
</body>
</html>
